name: VPS RDP via Tailscale (A)

on:
  workflow_dispatch:
    inputs:
      ts_tailnet:
        description: "Tailscale tailnet (e.g. you@gmail.com)"
        required: true
      ts_api_key:
        description: "Tailscale API key (device admin, no 'Bearer')"
        required: true
      ts_authkey:
        description: "Tailscale auth key (reusable or ephemeral)"
        required: true
      gh_api_token:
        description: "GitHub Personal Access Token (classic; scopes: repo, workflow)"
        required: true

concurrency:
  group: tailscale-rdp-singleton
  cancel-in-progress: false

permissions:
  contents: read
  actions: write

defaults:
  run:
    shell: bash

env:
  RDP_USER: bullettemporary
  RDP_PASS: Bullet@12345
  TS_HOSTNAME: bullet

jobs:
  rdp:
    runs-on: self-hosted   # ðŸ‘ˆ VPS runner
    timeout-minutes: 0     # ðŸ‘ˆ no limit
    steps:
      - name: Update & install dependencies
        run: |
          apt-get update -y
          apt-get install -y curl unzip xrdp jq || true

      - name: Install Tailscale (if missing) & show version
        run: |
          if ! command -v tailscale &> /dev/null; then
            curl -fsSL https://tailscale.com/install.sh | sh
          fi
          systemctl enable --now tailscaled || true
          ta
          
